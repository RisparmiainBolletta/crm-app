<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>CRM - Clienti</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f6f8;
            margin: 0;
            padding: 0 20px;
        }

        header {
            background-color: #2c3e50;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header img {
            height: 40px;
            margin-right: 10px;
        }

        h2 {
            margin: 0;
            font-size: 20px;
        }

        .logout {
            background-color: #e74c3c;
            border: none;
            padding: 8px 14px;
            color: white;
            cursor: pointer;
            border-radius: 4px;
        }

        #btn-nuovo {
            background-color: #3498db;
            color: white;
            padding: 8px 14px;
            border: none;
            border-radius: 4px;
            margin: 20px 0;
            cursor: pointer;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th, td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: left;
        }

        th {
            background-color: #ecf0f1;
        }

        .mini-btn {
            background: none;
            border: none;
            color: #2980b9;
            cursor: pointer;
            font-size: 14px;
            margin-right: 6px;
        }

        .sezione-extra {
            background-color: #ecf0f1;
            padding: 15px;
            border: 1px solid #bdc3c7;
            border-radius: 6px;
            margin-top: 10px;
        }

        .actions-dropdown {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        /* Stile per la finestra modale */
        dialog {
            width: 60%;
            border: none;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

            dialog::backdrop {
                background: rgba(0, 0, 0, 0.5);
            }

        .modal-content {
            position: relative;
        }

        .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            cursor: pointer;
        }

    </style>
</head>
<body>
    <header>
        <div style="display:flex; align-items:center;">
            <img src="logo.png" alt="Logo">
            <h2>Benvenuto, <span id="nome-agente">Agente</span></h2>
        </div>
        <button class="logout" onclick="logout()">Logout</button>
    </header>

    <button id="btn-nuovo" onclick="mostraFormNuovoCliente()">‚ûï Nuovo Cliente</button>

    <table>
        <!-- Finestra Modale per i Dettagli del Cliente -->
        <dialog id="dettagliClienteModal">
            <div class="modal-content">
                <span class="close-button" onclick="chiudiDettagliCliente()">&times;</span>
                <h2>Dettagli Cliente</h2>
                <div id="dettagliClienteContent">
                    <!-- I dettagli del cliente verranno inseriti qui -->
                </div>
            </div>
        </dialog>

        <thead>
            <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>Telefono</th>
                <th>Settore</th>
                <th>Stato</th>
                <th>Azioni</th>
            </tr>
        </thead>
        <tbody id="clienti-body"></tbody>
    </table>

    <div id="modale-nuovo-cliente" style="display:none;"></div>
    <div id="modale-dettagli-cliente" style="display:none;"></div>

    <script>
        function logout() {
            window.location.href = "/logout";
        }

        function mostraFormNuovoCliente() {
            alert("Form di inserimento cliente (da implementare)");
        }

        // Funzione per mostrare la finestra modale con i dettagli del cliente
        function mostraDettagliCliente(idCliente) {
            fetch(`/clienti/${idCliente}`)
                .then(response => response.json())
                .then(cliente => {
                    const dettagliContent = document.getElementById('dettagliClienteContent');
                    dettagliContent.innerHTML = `
                        <p><strong>ID Cliente:</strong> ${cliente.ID_Cliente}</p>
                        <p><strong>Nome:</strong> ${cliente.Nome}</p>
                        <p><strong>Telefono:</strong> ${cliente.Telefono}</p>
                        <p><strong>Settore:</strong> ${cliente.Settore}</p>
                        <p><strong>Stato:</strong> ${cliente.Stato}</p>
                        <!-- Aggiungi qui altri campi se necessario -->
                      `;
                    const modal = document.getElementById('dettagliClienteModal');
                    modal.showModal();
                })
                .catch(error => console.error('Errore nel recupero dei dettagli del cliente:', error));
        }

        // Funzione per chiudere la finestra modale
        function chiudiDettagliCliente() {
            const modal = document.getElementById('dettagliClienteModal');
            modal.close();
        }


        function mostraDocumenti(id) {
            alert("Documenti cliente: " + id);
        }

        function mostraInterazioni(id) {
            alert("Interazioni cliente: " + id);
        }

        function modificaCliente(id) {
            alert("Modifica cliente: " + id);
        }

        const clienti = [
            { ID_Cliente: "AG01-0001", Nome: "Mario Rossi", Telefono: "3331234567", Settore: "Energia", Stato: "Nuovo" },
            { ID_Cliente: "AG01-0002", Nome: "Giulia Bianchi", Telefono: "3497654321", Settore: "Gas", Stato: "Contattato" }
        ];

        window.onload = () => {
            const tbody = document.getElementById("clienti-body");
            clienti.reverse().forEach(c => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${c.ID_Cliente}</td>
                    <td>${c.Nome}</td>
                    <td>${c.Telefono}</td>
                    <td>${c.Settore}</td>
                    <td>${c.Stato}</td>
                    <td>
                        <div class="actions-dropdown">
                            <button class="mini-btn" onclick="mostraDettagliCliente('${cliente.ID_Cliente}')">üìÑ Dettagli</button>
                            <button class="mini-btn" onclick="mostraDocumenti('${c.ID_Cliente}')">üìé Documenti</button>
                            <button class="mini-btn" onclick="mostraInterazioni('${c.ID_Cliente}')">üìã Interazioni</button>
                            <button class="mini-btn" onclick="modificaCliente('${c.ID_Cliente}')">üìù Modifica</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
    </script>
</body>
</html>
